<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="dbevenius : Blog">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>dbevenius</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/danbev">View on GitHub</a>

          <h1 id="project_title">dbevenius</h1>
          <h2 id="project_tagline">Blog</h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>
<a name="swift-protocols-and-generics" class="anchor" href="#swift-protocols-and-generics"><span class="octicon octicon-link"></span></a>Swift protocols and generics.</h2>

<p>This is a description of an issue that I came across while working with generic and protocols in Swift.  </p>

<p>First a disclaimer, I'm coming from a Java background and might be trying something that is not the Swift "way", but I thought it might be worth posting what worked for me an perhaps someone else out there on the internets will set me straight and show me a better, or more correct way. </p>

<p>Basicially what I wanted was to define a generic protocol. This pretty easy in Swift, for example:</p>

<div class="highlight highlight-swift"><pre><span class="k">import</span> <span class="n">Foundation</span>

<span class="n">public</span> <span class="k">protocol</span> <span class="n">DataStore</span> <span class="p">{</span>

    <span class="k">typealias</span> <span class="n">ContentType</span>

    <span class="k">func</span> <span class="n">save</span><span class="p">(</span><span class="nl">data</span><span class="p">:</span> <span class="n">ContentType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span>

<span class="p">}</span>
</pre></div>

<p>And then we can have a concrete implementation for the above protocol: </p>

<div class="highlight highlight-swift"><pre><span class="k">import</span> <span class="n">Foundation</span>

<span class="n">public</span> <span class="k">class</span> <span class="n">InMemoryDataStore</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;:</span> <span class="n">DataStore</span> <span class="p">{</span>

    <span class="k">typealias</span> <span class="n">ContentType</span> <span class="o">=</span> <span class="n">T</span>

    <span class="n">public</span> <span class="k">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="k">func</span> <span class="n">save</span><span class="p">(</span><span class="nl">data</span><span class="p">:</span> <span class="n">ContentType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span> <span class="p">{</span>
        <span class="n">println</span><span class="p">(</span><span class="s">"Saving data: \(data)"</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Up to this point everything is pretty much as expected. My next thought was have a class that can get passed a DataStore in its initializer so that it can handle different types. My first attempt is shown below:</p>

<div class="highlight highlight-swift"><pre><span class="k">import</span> <span class="n">Foundation</span>

<span class="n">public</span> <span class="k">class</span> <span class="n">Manager</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="k">typealias</span> <span class="n">ContentType</span> <span class="o">=</span> <span class="n">T</span>

    <span class="k">let</span> <span class="nl">dataStore</span><span class="p">:</span> <span class="n">DataStore</span>

    <span class="n">public</span> <span class="k">init</span><span class="p">(</span><span class="nl">dataStore</span><span class="p">:</span> <span class="n">DataStore</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">self</span><span class="p">.</span><span class="n">dataStore</span> <span class="o">=</span> <span class="n">dataStore</span>  
    <span class="p">}</span>

    <span class="n">public</span> <span class="k">func</span> <span class="n">storeData</span><span class="p">(</span><span class="nl">data</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dataStore</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Now the above will not compile and the compiler will complain that:</p>

<pre><code>Protocol 'DataStore' can only be used as a generic constraint because it has Self or associated type requirements
</code></pre>

<p>So we need to add the type information in some way or use the protocol as a generic constraint. The following is using the DataStore protocol as a generic contraint:</p>

<div class="highlight highlight-swift"><pre><span class="k">import</span> <span class="n">Foundation</span>

<span class="n">public</span> <span class="k">class</span> <span class="n">Manager</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="nl">DS</span><span class="p">:</span> <span class="n">DataStore</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="k">typealias</span> <span class="n">ContentType</span> <span class="o">=</span> <span class="n">T</span>
    <span class="k">let</span> <span class="nl">dataStore</span><span class="p">:</span> <span class="n">DS</span>

    <span class="n">public</span> <span class="k">init</span><span class="p">(</span><span class="nl">dataStore</span><span class="p">:</span> <span class="n">DS</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">self</span><span class="p">.</span><span class="n">dataStore</span> <span class="o">=</span> <span class="n">dataStore</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="k">func</span> <span class="n">storeData</span><span class="p">(</span><span class="nl">data</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dataStore</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Now this does not compile either, and the compiler will complain about the type <code>T</code> for the <code>dataStore.save</code> method:</p>

<pre><code>Cannot convert the expression's type 'T' to type 'DS.ContentType'
</code></pre>

<p>So the type of the parameter <code>data</code> must be of type <code>DS.ContentType</code>, and indeed changing the type to that works:</p>

<div class="highlight highlight-swift"><pre><span class="k">import</span> <span class="n">Foundation</span>

<span class="n">public</span> <span class="k">class</span> <span class="n">Manager</span><span class="o">&lt;</span><span class="nl">DS</span><span class="p">:</span> <span class="n">DataStore</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="k">let</span> <span class="nl">dataStore</span><span class="p">:</span> <span class="n">DS</span>

    <span class="n">public</span> <span class="k">init</span><span class="p">(</span><span class="nl">dataStore</span><span class="p">:</span> <span class="n">DS</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">self</span><span class="p">.</span><span class="n">dataStore</span> <span class="o">=</span> <span class="n">dataStore</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="k">func</span> <span class="n">storeData</span><span class="p">(</span><span class="nl">data</span><span class="p">:</span> <span class="n">DS</span><span class="p">.</span><span class="n">ContentType</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dataStore</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>Notice also that I've removed the type <code>T</code> and the <code>typealias</code> as they were not actually doing anything.  </p>

<p>So what does using this Manager class look like:</p>

<div class="highlight highlight-swift"><pre><span class="k">import</span> <span class="n">XCTest</span>
<span class="k">import</span> <span class="n">Protocols</span>

<span class="k">class</span> <span class="nl">ManagerTests</span><span class="p">:</span> <span class="n">XCTestCase</span> <span class="p">{</span>

    <span class="k">func</span> <span class="n">testSaveDataStringContent</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">dataStore</span> <span class="o">=</span> <span class="n">InMemoryDataStore</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">()</span>
        <span class="k">let</span> <span class="n">manager</span> <span class="o">=</span> <span class="n">Manager</span><span class="p">(</span><span class="nl">dataStore</span><span class="p">:</span> <span class="n">dataStore</span><span class="p">)</span>
        <span class="n">manager</span><span class="p">.</span><span class="n">storeData</span><span class="p">(</span><span class="s">"text"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">func</span> <span class="n">testSaveDataIntContent</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">dataStore</span> <span class="o">=</span> <span class="n">InMemoryDataStore</span><span class="o">&lt;</span><span class="n">Int</span><span class="o">&gt;</span><span class="p">()</span>
        <span class="k">let</span> <span class="n">manager</span> <span class="o">=</span> <span class="n">Manager</span><span class="p">(</span><span class="nl">dataStore</span><span class="p">:</span> <span class="n">dataStore</span><span class="p">)</span>
        <span class="n">manager</span><span class="p">.</span><span class="n">storeData</span><span class="p">(</span><span class="mi">123456</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The code for this blog can be found on <a href="https://github.com/danbev/swift-generic-protocol-blog">github</a></p>

<h1></h1>

<h2>
<a name="aerogear-simplepush-server-080" class="anchor" href="#aerogear-simplepush-server-080"><span class="octicon octicon-link"></span></a>AeroGear SimplePush Server 0.8.0</h2>

<p>This is the first community release of <a href="http://aerogear.org">AeroGear</a>'s <a href="https://github.com/aerogear/aerogear-simplepush-server">SimplePush Server</a>.  </p>

<h3>
<a name="so-what-is-a-simplepush-server" class="anchor" href="#so-what-is-a-simplepush-server"><span class="octicon octicon-link"></span></a>So what is a SimplePush Server?</h3>

<p>It's a server side implementation of the <a href="https://wiki.mozilla.org/WebAPI/SimplePush/Protocol">SimplePush Protocol</a> specification from Mozilla. The SimplePush protocol describes a JavaScript client API and a protocol which allows backend applications to send notification messages to their web applications. </p>

<p>Firefox OS v1.1 uses SimplePush as its Push Notification technology. Firefox OS Push Notifications are designed for one 
thing â€“ waking up apps. They do not deal with data, desktop notifications or anything else, since there are other 
Web APIs that provide them. From the very beginning SimplePush was designed to explicitly not carry any payload. 
Instead a version number is sent to the client. Based on that version number the client can perfom an action, e.g. refresh a view of data.</p>

<h3>
<a name="aerogear-simplepush-server" class="anchor" href="#aerogear-simplepush-server"><span class="octicon octicon-link"></span></a>AeroGear SimplePush Server</h3>

<p>Mozilla provides a <a href="https://github.com/jrconlin/pushgo">server implementation</a> based on the Go programming language and <a href="https://github.com/aerogear/aerogear-js#simplepushclient">AeroGear's JavaScript client</a> will work against that implementation with out any problems. We wanted to provide another server option both for security (some companies would like more control over the push environment) and as a way to set up completely internal push networks. For example, a company with an internal app with a need for push notifications could deploy a SimplePush server on their internal network/VPN and have push messaging capability to their web apps without having to contact an outside server.</p>

<p>AeroGear SimplePush is a Java implementation of the server side part of the specification and two version are provided, one based on <a href="http://netty.io/">Netty</a>, and one based on <a href="http://vertx.io/">Vert.x</a>.  </p>

<p>The SimplePush specification states that secure WebSockets should be used as the transport protocol but for web applications this is  not always possible. Older browsers versions may lack WebSocket support, or issues with restrictive proxies in combination with WebSockets can lead to situations where the communication will simply not work. To counter this AeroGear's SimplePush server uses <a href="https://github.com/sockjs/sockjs-client/wiki/%5BArticle%5D-SockJS:-WebSocket-emulation-done-right">SockJS</a> to provide a fallback strategy. SockJS provides a client side and server side protocol and provides fallback handling in situations where a WebSocket connection cannot be made. AeroGear uses <a href="https://github.com/netty/netty/pull/1615">Netty's upcoming SockJS support</a> which takes care of the SockJS handling. </p>

<p>If you feel like trying things out we will shortly be providing an <a href="https://community.jboss.org/people/fjuma/blog/2013/08/19/downloadable-openshift-aerogear-push-server-cartridge-080">OpenShift cartridge</a> which will enable you to create a new application on OpenShift that contains both AeroGear SimplePush Server and <a href="https://github.com/aerogear/aerogear-unifiedpush-server">AeroGear UnifiedPush server</a>.<br>
You can also try out AeroGear SimplePush Server by building yourself. The deployment options are to run standalone or embedded in AS7/WildFly for the <a href="https://github.com/aerogear/aerogear-simplepush-server/tree/master/server-netty">Netty based version</a> and standalone for the <a href="https://github.com/aerogear/aerogear-simplepush-server/tree/master/server-vertx">Vert.x version</a>. Details of getting this up and running can be found in the modules.</p>

<p>For more information about the SimplePush protocol and how it works please refer to <a href="https://wiki.mozilla.org/WebAPI/SimplePush/Protocol">Mozilla's specification</a> and <a href="https://github.com/aerogear/aerogear-simplepush-server/tree/master/server-core">AeroGear SimplePush protocol documentation</a>. </p>

<p>If you have any questions, problems, or comments the please post to our <a href="http://aerogear.org/community/">mailing list</a>.</p>

<p>References</p>

<ul>
<li><a href="https://github.com/aerogear/aerogear-simplepush-server">AeroGear SimplePush Server</a></li>
<li><a href="https://github.com/aerogear/aerogear-simplepush-quickstart">AeroGear SimplePush Quickstart</a></li>
<li><a href="http://blog.krisborchers.com/2013/08/19/aerogear-js-1-2-0-has-been-pushed/">AeroGear JavaScript blog</a></li>
<li><a href="https://github.com/aerogear/aerogear-js#simplepushclient">AeroGear JavaScript SimplePushClient</a></li>
<li><a href="https://github.com/aerogear/aerogear-unifiedpush-server">AeroGear UnifiedPush Server</a></li>
<li><a href="http://corinnekrych.blogspot.fr/">AeroGear Example Push Application</a></li>
<li><a href="https://github.com/jrconlin/pushgo">Mozilla's SimplePush Server (Go Server)</a></li>
</ul><h1></h1>

<h2>
<a name="aerogear-controller-100" class="anchor" href="#aerogear-controller-100"><span class="octicon octicon-link"></span></a>AeroGear Controller 1.0.0</h2>

<p>We are pleased to announce the availablity of AeroGear Controller 1.0.0 which is a very lean model view controller written in Java. It focuses on the routing of HTTP requests to plain Java Object endpoints, and the handling of the results of these invocations. The results can either be forwarded to a view, or returned in the format requested by the caller.</p>

<p>Below is a list of some of the features that are available in 1.0.0:</p>

<ul>
<li>MVC routes</li>
<li>RESTFul endpoints</li>
<li>Pagination support</li>
<li>Secured routes support</li>
<li>CORS support</li>
</ul><p>What follows is a description of the pagination feature.Details about all the features can be found in the <a href="http://aerogear.org/docs/guides/aerogear-controller/">user guide</a>. </p>

<h3>
<a name="pagination-in-aerogear-controller" class="anchor" href="#pagination-in-aerogear-controller"><span class="octicon octicon-link"></span></a>Pagination in AeroGear Controller</h3>

<p>Pagination is the ability to return a limited number of elements in response to a call. The number of elements returned is referred to as a page. In AeroGear controller the strategy used for implementing pagination is using a offset/limit:</p>

<ul>
<li>
<code>offset</code><br>
The offset of the first element that should be included in the returned collection. Default value is <em>0</em>.</li>
<li>
<code>limit</code><br>
The number of elements that should be returned. Default value is <em>10</em>.</li>
</ul><p>Let's look at an example of what a Route with an endpoint that supports pagination looks like:</p>

<div class="highlight highlight-java"><pre><span class="n">route</span><span class="o">()</span>
      <span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"/cars"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
      <span class="o">.</span><span class="na">produces</span><span class="o">(</span><span class="n">JSON</span><span class="o">)</span>
      <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">Cars</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findCarsBy</span><span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">param</span><span class="o">(</span><span class="s">"color"</span><span class="o">));</span>
</pre></div>

<p><a href="http://staging.aerogear.org/docs/specs/aerogear-controller/org/jboss/aerogear/controller/router/rest/pagination/PaginationInfo.html">PaginationInfo</a> is used to avoid having to add the params for <code>offset</code> and <code>limit</code> which would otherwise have been required:</p>

<div class="highlight highlight-java"><pre><span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">Cars</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findCarsBy</span><span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="s">"offset"</span><span class="o">),</span> <span class="n">param</span><span class="o">(</span><span class="s">"limit"</span><span class="o">),</span> <span class="n">param</span><span class="o">(</span><span class="s">"color"</span><span class="o">));</span>
</pre></div>

<p>This might not look too bad, but imaging that you need to specify several query parameters in addition to <code>color</code> in the example above, and it can get pretty messy. So, instead we use <code>PaginationInfo</code> type which will be populated with values from the request which are then available to the target method. This information can then be used by the endpoint target method to return a paged collection of data.</p>

<p>The target endpoint method would be annotated, and this is where pagination can be configured:</p>

<div class="highlight highlight-java"><pre><span class="nd">@Paginated</span> 
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Car</span><span class="o">&gt;</span> <span class="nf">findCarsBy</span><span class="o">(</span><span class="n">PaginationInfo</span> <span class="n">paginationInfo</span><span class="o">,</span> <span class="n">String</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">getCars</span><span class="o">(</span><span class="n">paginationInfo</span><span class="o">.</span><span class="na">getOffset</span><span class="o">(),</span> <span class="n">color</span><span class="o">,</span> <span class="n">paginationInfo</span><span class="o">.</span><span class="na">getLimit</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>

<p><a href="https://github.com/aerogear/aerogear-controller/blob/master/src/main/java/org/jboss/aerogear/controller/router/rest/pagination/Paginated.java">Paginated</a> has options that can be overridden. For example, you can specify that you want to use different names of the query parameters than the default <code>offset</code>, <code>limit</code>, and that you'd like to use custom headers instead of Web Linking.<br>
The source for <a href="https://github.com/aerogear/aerogear-controller-demo/blob/master/src/main/java/org/jboss/aerogear/controller/demo/Cars.java#L83">findCarsBy</a> and the other examples in this post are part of <a href="https://github.com/aerogear/aerogear-controller-demo">aerogear-controller-demo</a>. </p>

<p>Related to pagination is also the ability to navigate, to get to the next/previous page. By default <a href="http://tools.ietf.org/html/rfc5988">Web Linking</a> is used to provide links to the next and previous pages as appropriate. 
Example of a HTTP response with Web Linking:</p>

<div class="highlight highlight-bash"><pre>HTTP/1.1 <span class="m">200</span> OK
Link: 
&lt;http://server/cars?offset<span class="o">=</span>0<span class="p">&amp;</span><span class="nv">color</span><span class="o">=</span>red<span class="p">&amp;</span><span class="nv">limit</span><span class="o">=</span>5&gt;<span class="p">;</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">"previous"</span>,  
&lt;http://server/cars?offset<span class="o">=</span>10<span class="p">&amp;</span><span class="nv">color</span><span class="o">=</span>red<span class="p">&amp;</span><span class="nv">limit</span><span class="o">=</span>5&gt;<span class="p">;</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">"next"</span>  
Content-Type: application/json<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>UTF-8
Content-Length: 200
<span class="o">[</span>
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Mazda"</span>,<span class="s2">"id"</span>:41<span class="o">}</span>,
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Mini"</span>,<span class="s2">"id"</span>:48<span class="o">}</span>,
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Nissan"</span>,<span class="s2">"id"</span>:55<span class="o">}</span>,
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Opel"</span>,<span class="s2">"id"</span>:62<span class="o">}</span>,
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Scoda"</span>,<span class="s2">"id"</span>:69<span class="o">}</span>
<span class="o">]</span>
</pre></div>

<p>Web Linking can be disabled in favor of the perhaps simpler option of custom headers.  </p>

<p>We would be more than happy to answer any questions you might have, and encourage you to try the demo on <a href="https://corscontroller-aerogear.rhcloud.com/aerogear-controller-demo/">OpenShift</a>. Links to source, mailing list, issue tracker etc, can be found in the Resources section below.</p>

<h2>
<a name="resources" class="anchor" href="#resources"><span class="octicon octicon-link"></span></a>Resources</h2>

<ul>
<li><a href="https://github.com/aerogear/aerogear-controller">AeroGear Controller</a></li>
<li><a href="https://github.com/aerogear/aerogear-controller-demo">AeroGear Controller Demo</a></li>
<li><a href="https://github.com/aerogear/aerogear-security">AeroGear Security</a></li>
<li><a href="http://aerogear.org/docs/guides/aerogear-controller">User Guide</a></li>
<li><a href="https://issues.jboss.org/browse/AEROGEAR">Issue Tracker</a></li>
<li><a href="http://aerogear.org/community">Mailing List</a></li>
<li><a href="http://aerogear.org">aerogear.org</a></li>
</ul><hr><h2>
<a name="whats-new-in-aerogear-controller-100m8" class="anchor" href="#whats-new-in-aerogear-controller-100m8"><span class="octicon octicon-link"></span></a>What's new in AeroGear Controller 1.0.0.M8</h2>

<p>With the 1.0.0.M8 release of AeroGear-Controller we have added the following features:</p>

<ul>
<li>Pagination support</li>
<li>Consuming/Producing custom media types</li>
</ul><h3>
<a name="pagination-in-aerogear-controller-1" class="anchor" href="#pagination-in-aerogear-controller-1"><span class="octicon octicon-link"></span></a>Pagination in AeroGear Controller</h3>

<p>Pagination is the ability to return a limited number of elements in response to a call. The number of elements returned is referred to as a page. In AeroGear controller the strategy used for implementing pagination is using an offset/limit:</p>

<ul>
<li>
<code>offset</code><br>
The offset of the first element that should be included in the returned collection. Default value is <em>0</em>.</li>
<li>
<code>limit</code><br>
The number of elements that should be returned. Default value is <em>10</em>.</li>
</ul><p>Let's look at an example of what a Route with an endpoint that supports pagination looks like:</p>

<div class="highlight highlight-java"><pre><span class="n">route</span><span class="o">()</span>
      <span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"/cars"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
      <span class="o">.</span><span class="na">produces</span><span class="o">(</span><span class="n">JSON</span><span class="o">)</span>
      <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">Cars</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findCarsBy</span><span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">param</span><span class="o">(</span><span class="s">"color"</span><span class="o">));</span>
</pre></div>

<p><code>PaginationInfo</code> is used to avoid having to add the params for <code>offset</code> and <code>limit</code> which would otherwise have been required:</p>

<div class="highlight highlight-java"><pre><span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">Cars</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findCarsBy</span><span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="s">"offset"</span><span class="o">),</span> <span class="n">param</span><span class="o">(</span><span class="s">"limit"</span><span class="o">),</span> <span class="n">param</span><span class="o">(</span><span class="s">"color"</span><span class="o">));</span>
</pre></div>

<p>This might not look too bad, but imaging that you need to specify several query parameters in addition to <code>color</code> in the example above, and it can get pretty messy. So, instead we use the <code>PaginationInfo</code> type which it will be populated with the request values which are then available to the target method. This information can then be used by the endpoint target method to return a paged collection of data.</p>

<p>The target endpoint method is annotated and this is where pagination can be configured:</p>

<div class="highlight highlight-java"><pre><span class="nd">@Paginated</span> 
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Car</span><span class="o">&gt;</span> <span class="nf">findCarsBy</span><span class="o">(</span><span class="n">PaginationInfo</span> <span class="n">paginationInfo</span><span class="o">,</span> <span class="n">String</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">getCars</span><span class="o">(</span><span class="n">paginationInfo</span><span class="o">.</span><span class="na">getOffset</span><span class="o">(),</span> <span class="n">color</span><span class="o">,</span> <span class="n">paginationInfo</span><span class="o">.</span><span class="na">getLimit</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>

<p><a href="https://github.com/aerogear/aerogear-controller/blob/master/src/main/java/org/jboss/aerogear/controller/router/rest/pagination/Paginated.java">@Paginated</a> has options that can be overridden. For example, you can specify that you want to use different names of the query parameters than the default <code>offset</code>, <code>limit</code>, and that you'd like to use custom headers instead of default Web Linking (more about this shortly).  </p>

<p>The source for <a href="https://github.com/aerogear/aerogear-controller-demo/blob/master/src/main/java/org/jboss/aerogear/controller/demo/Cars.java#L83">findCarsBy</a> and the other examples in this post are part of <a href="https://github.com/aerogear/aerogear-controller-demo">aerogear-controller-demo</a>. </p>

<p>Related to pagination is also the ability to navigate, to get to the next/previous page. By default <a href="http://tools.ietf.org/html/rfc5988">Web Linking</a> is used to provide links to the next and previous pages as appropriate. 
Example of a HTTP response with Web Linking:</p>

<div class="highlight highlight-bash"><pre>HTTP/1.1 <span class="m">200</span> OK
Link: 
&lt;http://controller-aerogear.rhcloud.com/aerogear-controller-demo/cars?offset<span class="o">=</span>0<span class="p">&amp;</span><span class="nv">color</span><span class="o">=</span>red<span class="p">&amp;</span><span class="nv">limit</span><span class="o">=</span>5&gt;<span class="p">;</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">"previous"</span>,  
&lt;http://controller-aerogear.rhcloud.com/aerogear-controller-demo/cars?offset<span class="o">=</span>10<span class="p">&amp;</span><span class="nv">color</span><span class="o">=</span>red<span class="p">&amp;</span><span class="nv">limit</span><span class="o">=</span>5&gt;<span class="p">;</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">"next"</span>  
Content-Type: application/json<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>UTF-8
Content-Length: 200
<span class="o">[</span>
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Mazda"</span>,<span class="s2">"id"</span>:41<span class="o">}</span>,
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Mini"</span>,<span class="s2">"id"</span>:48<span class="o">}</span>,
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Nissan"</span>,<span class="s2">"id"</span>:55<span class="o">}</span>,
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Opel"</span>,<span class="s2">"id"</span>:62<span class="o">}</span>,
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Scoda"</span>,<span class="s2">"id"</span>:69<span class="o">}</span>
<span class="o">]</span>
</pre></div>

<p>Web Linking can be disabled in favor of the perhaps simpler option of custom headers as mentioned above using the <a href="https://github.com/aerogear/aerogear-controller/blob/master/src/main/java/org/jboss/aerogear/controller/router/rest/pagination/Paginated.java">@Paginated</a> annotation.</p>

<h3>
<a name="consumingproducing-custom-media-types" class="anchor" href="#consumingproducing-custom-media-types"><span class="octicon octicon-link"></span></a>Consuming/Producing custom media types</h3>

<p>This support enables specifying that a route can consume a custom media type, or produce a custom media type, or both.<br>
For example:</p>

<div class="highlight highlight-java"><pre><span class="n">route</span><span class="o">()</span>
      <span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"/cars"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
      <span class="o">.</span><span class="na">consumes</span><span class="o">(</span><span class="n">CUSTOM_MEDIA_TYPE</span><span class="o">)</span>
      <span class="o">.</span><span class="na">produces</span><span class="o">(</span><span class="n">CUSTOM_MEDIA_TYPE</span><span class="o">)</span>
      <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">Cars</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">save</span><span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="n">Car</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</pre></div>

<p>The above example declares that this route will be able to consume and produce a custom media type. You can specify multiple media types for both the <code>consumes</code> and the <code>produces</code> method. The client uses the HTTP <code>Accept</code> header to specify what type it wants the server to respond with. </p>

<h4>
<a name="adding-a-custom-consumer" class="anchor" href="#adding-a-custom-consumer"><span class="octicon octicon-link"></span></a>Adding a Custom consumer</h4>

<p>A consumer is added to the system by adding a class that implements the <a href="https://github.com/aerogear/aerogear-controller/blob/master/src/main/java/org/jboss/aerogear/controller/router/Consumer.java">Consumer</a> interface. This will be picked up by the CDI container and registered for that specific content type. </p>

<h4>
<a name="adding-a-custom-producerresponder" class="anchor" href="#adding-a-custom-producerresponder"><span class="octicon octicon-link"></span></a>Adding a Custom Producer/Responder</h4>

<p>Adding a producer/responder currently differs from adding a consumer. The reason for this is that we discovered the need to be able to respond to the same media type in different ways.<br>
For example, a client may request that it <code>Accept: text/html</code>. But the route could choose to respond with either a dynamically generated JSP, or a static HTML page.  </p>

<p>So, let's take a look at what is required to implement a custom media type responder that returns data in a custom format to the caller, as opposed to forwarding the responds to a view:</p>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomResponder</span> <span class="kd">extends</span> <span class="n">AbstractRestResponder</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">MediaType</span> <span class="n">CUSTOM_MEDIA_TYPE</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MediaType</span><span class="o">(</span><span class="s">"application/custom"</span><span class="o">,</span> <span class="n">CustomResponder</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">public</span> <span class="nf">CustomResponder</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">CUSTOM_MEDIA_TYPE</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeResponse</span><span class="o">(</span><span class="n">Object</span> <span class="n">entity</span><span class="o">,</span> <span class="n">RouteContext</span> <span class="n">routeContext</span><span class="o">)</span> 
        <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">HttpServletResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">routeContext</span><span class="o">.</span><span class="na">getResponse</span><span class="o">();</span>
        <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">"CustomResponder returned: "</span> <span class="o">+</span> <span class="n">entity</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>

<p>If you also implement <a href="https://github.com/aerogear/aerogear-controller/blob/master/src/main/java/org/jboss/aerogear/controller/router/Responder.java">Responder</a> directly if you have the need to forward to a view instead of responding of if you simply prefer to implement an interface or can't extend.  </p>

<p>We would be more than happy to answer any questions you might have, and encourage you to try the demo on <a href="https://corscontroller-aerogear.rhcloud.com/aerogear-controller-demo/">OpenShift</a>. Links to source, mailing list, issue tracker etc, can be found in the Resources section below.</p>

<h2>
<a name="resources-1" class="anchor" href="#resources-1"><span class="octicon octicon-link"></span></a>Resources</h2>

<ul>
<li><a href="https://github.com/aerogear/aerogear-controller">aerogear-controller</a></li>
<li><a href="https://github.com/aerogear/aerogear-controller-demo">aerogear-controller-demo</a></li>
<li><a href="http://aerogear.org">aerogear.org</a></li>
<li><a href="https://issues.jboss.org/browse/AEROGEAR">Issue Tracker</a></li>
<li><a href="http://aerogear.org/community">Mailing List</a></li>
</ul><hr><h2>
<a name="whats-new-in-aerogear-controller-100m1" class="anchor" href="#whats-new-in-aerogear-controller-100m1"><span class="octicon octicon-link"></span></a>What's new in AeroGear Controller 1.0.0.M1</h2>

<p>With the 1.0.0.M1 release of AeroGear-Controller we have added the following features:</p>

<ul>
<li>Error Routes</li>
<li>CORS support</li>
<li>RESTful endpoint (partially supported)</li>
</ul><h3>
<a name="error-routes" class="anchor" href="#error-routes"><span class="octicon octicon-link"></span></a>Error Routes</h3>

<p>You can now configure a route as an error handler for a type of exception:</p>

<div class="highlight highlight-java"><pre><span class="n">route</span><span class="o">()</span>
       <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">YourException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
       <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">ExceptionHandler</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">errorPage</span><span class="o">();</span> 
</pre></div>

<p>You can specify multiple exceptions if needed:</p>

<div class="highlight highlight-java"><pre><span class="n">route</span><span class="o">()</span>
       <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">YourException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">SomeOtherException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
       <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">ExceptionHandler</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">errorPage</span><span class="o">();</span>
</pre></div>

<p>If you'd like to log the exception in the error route, you can specify that the target method, errorPage() above, should 
take a parameter:</p>

<div class="highlight highlight-java"><pre><span class="n">route</span><span class="o">()</span>
       <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">YourException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">SomeOtherException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
       <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">ExceptionHandler</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">errorPage</span><span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="n">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</pre></div>

<p>As mentioned previously in this document a view for ExceptionHandler would in this case be located in:</p>

<pre><code>/WEB-INF/pages/ExceptionHandler/errorPage.jsp   
</code></pre>

<p>The exception is made available to the jsp page:</p>

<pre><code>${requestScope['org.jboss.aerogear.controller.exception']}
</code></pre>

<h3>
<a name="cross-origin-resource-sharing--cors-support" class="anchor" href="#cross-origin-resource-sharing--cors-support"><span class="octicon octicon-link"></span></a>Cross Origin Resource Sharing  (CORS) Support</h3>

<p>CORS is supported by default but can be disabled or configured differently by implementing a CDI Producer:</p>

<div class="highlight highlight-java"><pre><span class="nd">@Produces</span>
<span class="kd">public</span> <span class="n">CorsConfiguration</span> <span class="nf">demoConfig</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">CorsConfig</span><span class="o">.</span><span class="na">enableCorsSupport</span><span class="o">()</span>
                      <span class="o">.</span><span class="na">anyOrigin</span><span class="o">()</span>
                      <span class="o">.</span><span class="na">enableCookies</span><span class="o">()</span>
                      <span class="o">.</span><span class="na">exposeHeaders</span><span class="o">(</span><span class="s">"header1"</span><span class="o">)</span>
                      <span class="o">.</span><span class="na">maxAge</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span>
                      <span class="o">.</span><span class="na">enableAllRequestMethods</span><span class="o">()</span>
                      <span class="o">.</span><span class="na">validRequestHeaders</span><span class="o">(</span><span class="s">"header1"</span><span class="o">);</span>
    <span class="o">}</span>
</pre></div>

<p>To disable CORS support</p>

<div class="highlight highlight-java"><pre><span class="nd">@Produces</span>
<span class="kd">public</span> <span class="n">CorsConfiguration</span> <span class="nf">demoConfig</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">CorsConfig</span><span class="o">.</span><span class="na">disableCorsSupport</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>

<h3>
<a name="restful-endpoints" class="anchor" href="#restful-endpoints"><span class="octicon octicon-link"></span></a>RESTful endpoints</h3>

<p>In previous versions of AeroGear-Controller there was only support for forwarding requests to views, in a model-view-controller style. 
With version M7 there is partial support for RESTful endpoints.  </p>

<p>For example, you can now specify that a Route produces a response:</p>

<div class="highlight highlight-java"><pre><span class="n">route</span><span class="o">()</span>
       <span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"/cars"</span><span class="o">)</span>
       <span class="o">.</span><span class="na">roles</span><span class="o">(</span><span class="s">"admin"</span><span class="o">)</span>
       <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
       <span class="o">.</span><span class="na">produces</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">JSON</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">HTML</span><span class="o">.</span><span class="na">toString</span><span class="o">())</span>
       <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">Home</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">save</span><span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="n">Car</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</pre></div>

<p>In the above example, a POST to this route can respond with either JSON or HTML (forwarding to a view) depending on the HTTP Accept Header. Also, this route will only be accessible to a user belonging to the <em>admin</em> group.</p>

<p>As mentioned RESTful support is only partially implemented as we still need to be able to consume other formats, like JSON for example. This will be added with CR1 and full support will exist in 1.0.0. </p>

<p>We would be more than happy to answer any questions you might have, and encourage you to try the <a href="https://controller-aerogear.rhcloud.com/aerogear-controller-demo/">demo on OpenShift</a>. Links to source, mailing list, issue tracker etc, can be found in the <em>Resources</em> section below.</p>

<h2>
<a name="whats-next" class="anchor" href="#whats-next"><span class="octicon octicon-link"></span></a>What's next?</h2>

<ul>
<li>Support for consuming media types enabling routes to consume and produce JSON or any other type.</li>
<li>Support for more parameter type like header, cookie parameters.</li>
<li>Paging</li>
</ul><h2>
<a name="resources-2" class="anchor" href="#resources-2"><span class="octicon octicon-link"></span></a>Resources</h2>

<ul>
<li><a href="https://github.com/danbev/aerogear-controller">aerogear-controller</a></li>
<li><a href="https://github.com/danbev/aerogear-controller-demo">aerogear-controller-demo</a></li>
<li><a href="http://aerogear.org">aerogear.org</a></li>
<li><a href="https://issues.jboss.org/browse/AEROGEAR">Issue Tracker</a></li>
<li><a href="http://aerogear.org/community/">Mailing List</a></li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
