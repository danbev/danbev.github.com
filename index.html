<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>danbev.github.com by danbev</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>danbev.github.com</h1>
        <p>Blog</p>


        <p class="view"><a href="https://github.com/danbev">View My GitHub Profile</a></p>

      </header>
      <section>
        <h2>What's new in AeroGear Controller 1.0.0.M8</h2>

<p>With the 1.0.0.M8 release of AeroGear-Controller we have added the following features:</p>

<ul>
<li>Pagination support</li>
<li>Consuming/Producing custom media types</li>
</ul><h3>Pagination in AeroGear Controller</h3>

<p>Pagination is the ability to return a limited number of elements in response to a call. The number of elements returned is referred to as a page. In AeroGear controller the strategy used for implementing pagination is using an offset/limit:</p>

<ul>
<li>
<code>offset</code><br>
The offset of the first element that should be included in the returned collection. Default value is <em>0</em>.</li>
<li>
<code>limit</code><br>
The number of elements that should be returned. Default value is <em>10</em>.</li>
</ul><p>Let's look at an example of what a Route with an endpoint that supports pagination looks like:</p>

<div class="highlight"><pre><span class="n">route</span><span class="o">()</span>
      <span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"/cars"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
      <span class="o">.</span><span class="na">produces</span><span class="o">(</span><span class="n">JSON</span><span class="o">)</span>
      <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">Cars</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findCarsBy</span><span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="n">PaginationInfo</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">param</span><span class="o">(</span><span class="s">"color"</span><span class="o">));</span>
</pre></div>

<p><code>PaginationInfo</code> is used to avoid having to add the params for <code>offset</code> and <code>limit</code> which would otherwise have been required:</p>

<div class="highlight"><pre><span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">Cars</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">findCarsBy</span><span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="s">"offset"</span><span class="o">),</span> <span class="n">param</span><span class="o">(</span><span class="s">"limit"</span><span class="o">),</span> <span class="n">param</span><span class="o">(</span><span class="s">"color"</span><span class="o">));</span>
</pre></div>

<p>This might not look too bad, but imaging that you need to specify several query parameters in addition to <code>color</code> in the example above, and it can get pretty messy. So, instead we use the <code>PaginationInfo</code> type which it will be populated with the request values which are then available to the target method. This information can then be used by the endpoint target method to return a paged collection of data.</p>

<p>The target endpoint method is annotated and this is where pagination can be configured:</p>

<div class="highlight"><pre><span class="nd">@Paginated</span> 
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Car</span><span class="o">&gt;</span> <span class="n">findCarsBy</span><span class="o">(</span><span class="n">PaginationInfo</span> <span class="n">paginationInfo</span><span class="o">,</span> <span class="n">String</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">getCars</span><span class="o">(</span><span class="n">paginationInfo</span><span class="o">.</span><span class="na">getOffset</span><span class="o">(),</span> <span class="n">color</span><span class="o">,</span> <span class="n">paginationInfo</span><span class="o">.</span><span class="na">getLimit</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>

<p><a href="https://github.com/aerogear/aerogear-controller/blob/master/src/main/java/org/jboss/aerogear/controller/router/rest/pagination/Paginated.java">@Paginated</a> has options that can be overridden. For example, you can specify that you want to use different names of the query parameters than the default <code>offset</code>, <code>limit</code>, and that you'd like to use custom headers instead of default Web Linking (more about this shortly).  </p>

<p>The source for <a href="https://github.com/aerogear/aerogear-controller-demo/blob/master/src/main/java/org/jboss/aerogear/controller/demo/Cars.java#L83">findCarsBy</a> and the other examples in this post are part of <a href="https://github.com/aerogear/aerogear-controller-demo">aerogear-controller-demo</a>. </p>

<p>Related to pagination is also the ability to navigate, to get to the next/previous page. By default <a href="http://tools.ietf.org/html/rfc5988">Web Linking</a> is used to provide links to the next and previous pages as appropriate. 
Example of a HTTP response with Web Linking:</p>

<div class="highlight"><pre>HTTP/1.1 200 OK
Link: 
&lt;http://controller-aerogear.rhcloud.com/aerogear-controller-demo/cars?offset<span class="o">=</span>0&amp;color<span class="o">=</span>red&amp;limit<span class="o">=</span>5&gt;; <span class="nv">rel</span><span class="o">=</span><span class="s2">"previous"</span>,  
&lt;http://controller-aerogear.rhcloud.com/aerogear-controller-demo/cars?offset<span class="o">=</span>10&amp;color<span class="o">=</span>red&amp;limit<span class="o">=</span>5&gt;; <span class="nv">rel</span><span class="o">=</span><span class="s2">"next"</span>  
Content-Type: application/json;charset<span class="o">=</span>UTF-8
Content-Length: 200
<span class="o">[</span>
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Mazda"</span>,<span class="s2">"id"</span>:41<span class="o">}</span>,
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Mini"</span>,<span class="s2">"id"</span>:48<span class="o">}</span>,
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Nissan"</span>,<span class="s2">"id"</span>:55<span class="o">}</span>,
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Opel"</span>,<span class="s2">"id"</span>:62<span class="o">}</span>,
      <span class="o">{</span><span class="s2">"color"</span>:<span class="s2">"red"</span>,<span class="s2">"brand"</span>:<span class="s2">"Scoda"</span>,<span class="s2">"id"</span>:69<span class="o">}</span>
<span class="o">]</span>
</pre></div>

<p>Web Linking can be disabled in favor of the perhaps simpler option of custom headers as mentioned above using the <a href="https://github.com/aerogear/aerogear-controller/blob/master/src/main/java/org/jboss/aerogear/controller/router/rest/pagination/Paginated.java">@Paginated</a> annotation.</p>

<h3>Consuming/Producing custom media types</h3>

<p>This support enables specifying that a route can consume a custom media type, or produce a custom media type, or both.<br>
For example:</p>

<div class="highlight"><pre><span class="n">route</span><span class="o">()</span>
      <span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"/cars"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
      <span class="o">.</span><span class="na">consumes</span><span class="o">(</span><span class="n">CUSTOM_MEDIA_TYPE</span><span class="o">)</span>
      <span class="o">.</span><span class="na">produces</span><span class="o">(</span><span class="n">CUSTOM_MEDIA_TYPE</span><span class="o">)</span>
      <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">Cars</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">save</span><span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="n">Car</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</pre></div>

<p>The above example declares that this route will be able to consume and produce a custom media type. You can specify multiple media types for both the <code>consumes</code> and the <code>produces</code> method. The client uses the HTTP <code>Accept</code> header to specify what type it wants the server to respond with. </p>

<h4>Adding a Custom consumer</h4>

<p>A consumer is added to the system by adding a class that implements the <a href="https://github.com/aerogear/aerogear-controller/blob/master/src/main/java/org/jboss/aerogear/controller/router/Consumer.java">Consumer</a> interface. This will be picked up by the CDI container and registered for that specific content type. </p>

<h4>Adding a Custom Producer/Responder</h4>

<p>Adding a producer/responder currently differs from adding a consumer. The reason for this is that we discovered the need to be able to respond to the same media type in different ways.<br>
For example, a client may request that it <code>Accept: text/html</code>. But the route could choose to respond with either a dynamically generated JSP, or a static HTML page.  </p>

<p>So, let's take a look at what is required to implement a custom media type responder that returns data in a custom format to the caller, as opposed to forwarding the responds to a view:</p>

<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomResponder</span> <span class="kd">extends</span> <span class="n">AbstractRestResponder</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">MediaType</span> <span class="n">CUSTOM_MEDIA_TYPE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MediaType</span><span class="o">(</span><span class="s">"application/custom"</span><span class="o">,</span> <span class="n">CustomResponder</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">public</span> <span class="nf">CustomResponder</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">CUSTOM_MEDIA_TYPE</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeResponse</span><span class="o">(</span><span class="n">Object</span> <span class="n">entity</span><span class="o">,</span> <span class="n">RouteContext</span> <span class="n">routeContext</span><span class="o">)</span> 
        <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">HttpServletResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">routeContext</span><span class="o">.</span><span class="na">getResponse</span><span class="o">();</span>
        <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">"CustomResponder returned: "</span> <span class="o">+</span> <span class="n">entity</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>

<p>If you also implement <a href="https://github.com/aerogear/aerogear-controller/blob/master/src/main/java/org/jboss/aerogear/controller/router/Responder.java">Responder</a> directly if you have the need to forward to a view instead of responding of if you simply prefer to implement an interface or can't extend.  </p>

<p>We would be more than happy to answer any questions you might have, and encourage you to try the demo on <a href="https://corscontroller-aerogear.rhcloud.com/aerogear-controller-demo/">OpenShift</a>. Links to source, mailing list, issue tracker etc, can be found in the Resources section below.</p>

<h2>Resources</h2>

<ul>
<li><a href="https://github.com/aerogear/aerogear-controller">aerogear-controller</a></li>
<li><a href="https://github.com/aerogear/aerogear-controller-demo">aerogear-controller-demo</a></li>
<li><a href="http://aerogear.org">aerogear.org</a></li>
<li><a href="https://issues.jboss.org/browse/AEROGEAR">Issue Tracker</a></li>
<li><a href="http://aerogear.org/community">Mailing List</a></li>
</ul><hr><h1>What's new in AeroGear Controller 1.0.0.M1</h1>

<p>With the 1.0.0.M1 release of AeroGear-Controller we have added the following features:</p>

<ul>
<li>Error Routes</li>
<li>CORS support</li>
<li>RESTful endpoint (partially supported)</li>
</ul><h3>Error Routes</h3>

<p>You can now configure a route as an error handler for a type of exception:</p>

<div class="highlight"><pre><span class="n">route</span><span class="o">()</span>
       <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">YourException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
       <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">ExceptionHandler</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">errorPage</span><span class="o">();</span> 
</pre></div>

<p>You can specify multiple exceptions if needed:</p>

<div class="highlight"><pre><span class="n">route</span><span class="o">()</span>
       <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">YourException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">SomeOtherException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
       <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">ExceptionHandler</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">errorPage</span><span class="o">();</span>
</pre></div>

<p>If you'd like to log the exception in the error route, you can specify that the target method, errorPage() above, should 
take a parameter:</p>

<div class="highlight"><pre><span class="n">route</span><span class="o">()</span>
       <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">YourException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">SomeOtherException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
       <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">ExceptionHandler</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">errorPage</span><span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="n">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</pre></div>

<p>As mentioned previously in this document a view for ExceptionHandler would in this case be located in:</p>

<pre><code>/WEB-INF/pages/ExceptionHandler/errorPage.jsp   
</code></pre>

<p>The exception is made available to the jsp page:</p>

<pre><code>${requestScope['org.jboss.aerogear.controller.exception']}
</code></pre>

<h3>Cross Origin Resource Sharing  (CORS) Support</h3>

<p>CORS is supported by default but can be disabled or configured differently by implementing a CDI Producer:</p>

<div class="highlight"><pre><span class="nd">@Produces</span>
<span class="kd">public</span> <span class="n">CorsConfiguration</span> <span class="nf">demoConfig</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">CorsConfig</span><span class="o">.</span><span class="na">enableCorsSupport</span><span class="o">()</span>
                      <span class="o">.</span><span class="na">anyOrigin</span><span class="o">()</span>
                      <span class="o">.</span><span class="na">enableCookies</span><span class="o">()</span>
                      <span class="o">.</span><span class="na">exposeHeaders</span><span class="o">(</span><span class="s">"header1"</span><span class="o">)</span>
                      <span class="o">.</span><span class="na">maxAge</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span>
                      <span class="o">.</span><span class="na">enableAllRequestMethods</span><span class="o">()</span>
                      <span class="o">.</span><span class="na">validRequestHeaders</span><span class="o">(</span><span class="s">"header1"</span><span class="o">);</span>
    <span class="o">}</span>
</pre></div>

<p>To disable CORS support</p>

<div class="highlight"><pre><span class="nd">@Produces</span>
<span class="kd">public</span> <span class="n">CorsConfiguration</span> <span class="nf">demoConfig</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">CorsConfig</span><span class="o">.</span><span class="na">disableCorsSupport</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>

<h3>RESTful endpoints</h3>

<p>In previous versions of AeroGear-Controller there was only support for forwarding requests to views, in a model-view-controller style. 
With version M7 there is partial support for RESTful endpoints.  </p>

<p>For example, you can now specify that a Route produces a response:</p>

<div class="highlight"><pre><span class="n">route</span><span class="o">()</span>
       <span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"/cars"</span><span class="o">)</span>
       <span class="o">.</span><span class="na">roles</span><span class="o">(</span><span class="s">"admin"</span><span class="o">)</span>
       <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
       <span class="o">.</span><span class="na">produces</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">JSON</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">HTML</span><span class="o">.</span><span class="na">toString</span><span class="o">())</span>
       <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">Home</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">save</span><span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="n">Car</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</pre></div>

<p>In the above example, a POST to this route can respond with either JSON or HTML (forwarding to a view) depending on the HTTP Accept Header. Also, this route will only be accessible to a user belonging to the <em>admin</em> group.</p>

<p>As mentioned RESTful support is only partially implemented as we still need to be able to consume other formats, like JSON for example. This will be added with CR1 and full support will exist in 1.0.0. </p>

<p>We would be more than happy to answer any questions you might have, and encourage you to try the <a href="https://controller-aerogear.rhcloud.com/aerogear-controller-demo/">demo on OpenShift</a>. Links to source, mailing list, issue tracker etc, can be found in the <em>Resources</em> section below.</p>

<h2>What's next?</h2>

<ul>
<li>Support for consuming media types enabling routes to consume and produce JSON or any other type.</li>
<li>Support for more parameter type like header, cookie parameters.</li>
<li>Paging</li>
</ul><h2>Resources</h2>

<ul>
<li><a href="https://github.com/danbev/aerogear-controller">aerogear-controller</a></li>
<li><a href="https://github.com/danbev/aerogear-controller-demo">aerogear-controller-demo</a></li>
<li><a href="http://aerogear.org">aerogear.org</a></li>
<li><a href="https://issues.jboss.org/browse/AEROGEAR">Issue Tracker</a></li>
<li><a href="http://aerogear.org/community/">Mailing List</a></li>
</ul>
      </section>
      <footer>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>