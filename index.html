<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>daniel.bevenius</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>daniel.bevenius</h1>

        <p class="view"><a href="https://github.com/danbev">GitHub Profile</a></p>

      </header>
      <section>
        <h1>What's new in AeroGear Controller</h1>

<p>New features in the M7</p>

<ul>
<li>Error Routes</li>
<li>CORS support</li>
<li>RESTful endpoint (partially supported)</li>
</ul><h3>Error Routes</h3>

<p>You can now configure a route as an error handler for a type of exception:</p>

<div class="highlight"><pre><span class="n">route</span><span class="o">()</span>
       <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">YourException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
       <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">ExceptionHandler</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">errorPage</span><span class="o">();</span> 
</pre></div>

<p>You can specify multiple exceptions if needed:</p>

<div class="highlight"><pre><span class="n">route</span><span class="o">()</span>
       <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">YourException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">SomeOtherException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
       <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">ExceptionHandler</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">errorPage</span><span class="o">();</span>
</pre></div>

<p>If you'd like to log the exception in the error route, you can specify that the target method, errorPage() above, should 
take a parameter:</p>

<div class="highlight"><pre><span class="n">route</span><span class="o">()</span>
       <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">YourException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">SomeOtherException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
       <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">ExceptionHandler</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">errorPage</span><span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="n">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</pre></div>

<p>As mentioned previously in this document a view for ExceptionHandler would in this case be located in:</p>

<pre><code>/WEB-INF/pages/ExceptionHandler/errorPage.jsp   
</code></pre>

<p>The exception is made available to the jsp page:</p>

<pre><code>${requestScope['org.jboss.aerogear.controller.exception']}
</code></pre>

<h3>Cross Origin Resource Sharing  (CORS) Support</h3>

<p>CORS is supported by default but can be disabled or configured differently by implementing a CDI Producer:</p>

<div class="highlight"><pre><span class="nd">@Produces</span>
<span class="kd">public</span> <span class="n">CorsConfiguration</span> <span class="nf">demoConfig</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">CorsConfig</span><span class="o">.</span><span class="na">enableCorsSupport</span><span class="o">()</span>
                      <span class="o">.</span><span class="na">anyOrigin</span><span class="o">()</span>
                      <span class="o">.</span><span class="na">enableCookies</span><span class="o">()</span>
                      <span class="o">.</span><span class="na">exposeHeaders</span><span class="o">(</span><span class="s">"header1"</span><span class="o">)</span>
                      <span class="o">.</span><span class="na">maxAge</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span>
                      <span class="o">.</span><span class="na">enableAllRequestMethods</span><span class="o">()</span>
                      <span class="o">.</span><span class="na">validRequestHeaders</span><span class="o">(</span><span class="s">"header1"</span><span class="o">);</span>
    <span class="o">}</span>
</pre></div>

<p>To disable CORS support</p>

<div class="highlight"><pre><span class="nd">@Produces</span>
<span class="kd">public</span> <span class="n">CorsConfiguration</span> <span class="nf">demoConfig</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">CorsConfig</span><span class="o">.</span><span class="na">disableCorsSupport</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>

<h3>RESTful endpoints</h3>

<p>In previous versions of AeroGear-Controller there was only support for forwarding requests to views, in a model-view-controller style. 
With version M7 there is partial support for RESTful endpoints.  </p>

<p>For example, you can now specify that a Route produces a response:</p>

<div class="highlight"><pre><span class="n">route</span><span class="o">()</span>
       <span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"/cars"</span><span class="o">)</span>
       <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
       <span class="o">.</span><span class="na">produces</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">JSON</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">HTML</span><span class="o">.</span><span class="na">toString</span><span class="o">())</span>
       <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="n">Home</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">save</span><span class="o">(</span><span class="n">param</span><span class="o">(</span><span class="n">Car</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</pre></div>

<p>In the above example, a POST to this route can respond with either JSON or HTML (forwarding to a view) depending on the HTTP Accept Header.  </p>

<p>As mentioned RESTful support is only partially implemented as we still need to be able to consume other formats, like JSON for example. This will be added with CR1 and full support will exist in 1.0.0. </p>

<h2>What's next?</h2>

<ul>
<li>Support for consuming media types enabling routes to consume and produce JSON or any other type.</li>
<li>Support for more parameter type like header, cookie parameters.</li>
<li>Paging</li>
</ul>
      </section>
      <footer>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
